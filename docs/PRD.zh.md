# 产品需求文档 (PRD)
## My Tracker 应用程序

**版本:** 0.2.0
**最后更新:** 2025-01-27  
**状态:** 积极开发中

---

## 执行摘要

My Tracker 是一款基于 Web 的应用程序，旨在帮助用户同时跟踪多个物流/跟踪单号。该应用程序提供了一个简单、高效的界面，用于从 auodexpress.com API 查询跟踪状态并实时显示结果。

## 产品目标

### 主要目标
1. 使用户能够在单一界面中跟踪多个物流单号
2. 提供带进度跟踪的实时状态更新
3. 跨会话持久化用户输入数据
4. 提供快速、响应的用户体验

### 次要目标
1. 支持跨设备数据同步（通过 Supabase 迁移）
2. 保持简洁、直观的用户界面
3. 优雅地处理 API 错误
4. 支持批量处理跟踪查询

## 用户画像

### 主要画像：物流协调员
- **角色**: 每天管理多个货物运输
- **需求**: 快速访问多个包裹的跟踪状态
- **痛点**: 在不同跟踪系统之间切换，手动复制粘贴操作
- **目标**: 在一个地方高效监控货物状态

### 次要画像：电商经理
- **角色**: 监督订单履行和运输
- **需求**: 跟踪客户订单和交付状态
- **痛点**: 耗时的单独跟踪查询
- **目标**: 批量跟踪操作以节省时间

## 用户故事

### 故事 1：多行输入
**作为** 物流协调员  
**我想要** 一次性粘贴多个跟踪单号  
**以便** 我可以高效地跟踪所有货物

**验收标准:**
- 用户可以粘贴多个跟踪单号（每行一个）
- 应用程序保留换行符并分别处理每一行
- 输入在用户输入时自动保存

### 故事 2：批量跟踪查询
**作为** 用户  
**我想要** 一次性提交所有跟踪单号  
**以便** 我可以同时获得所有货物的状态更新

**验收标准:**
- 提交按钮触发所有已输入跟踪单号的 API 调用
- 进度计数器显示剩余查询数
- 结果在可用时显示

### 故事 3：数据持久化
**作为** 用户  
**我想要** 我的跟踪单号自动保存  
**以便** 我在刷新页面时不会丢失工作

**验收标准:**
- 输入数据在浏览器会话之间持久化（当前为 localStorage）
- 数据在页面加载时自动加载
- 未来：数据跨设备同步（Supabase 迁移）

### 故事 4：状态显示
**作为** 用户  
**我想要** 看到每个跟踪单号的状态和创建日期  
**以便** 我可以了解货物的当前状态

**验收标准:**
- 每个跟踪单号显示其对应的状态
- 创建日期与状态一起显示
- 状态通过颜色编码进行视觉分类（已送达 = 红色，运输中 = 黄色，其他 = 默认）
- 已送达和运输中的物品显示快递代码
- 结果格式清晰，易于阅读

### 故事 5：智能缓存
**作为** 用户  
**我想要** 系统跳过查询已送达的包裹  
**以便** 我获得更快的结果并减少不必要的 API 调用

**验收标准:**
- 系统在进行 API 调用之前检查现有结果
- 已送达的物品（状态包含"感谢使用"）不会重新查询
- 缓存的结果被保留并立即显示
- 进度计数器准确反映剩余查询数

## 功能规格

### 当前功能

#### 1. 多行文本输入
- **描述**: 接受多个跟踪单号的文本区域组件
- **输入格式**: 每行一个跟踪单号
- **验证**: 当前无验证（接受任何文本输入）
- **存储**: 每次更改时保存到 localStorage

#### 2. 批量 API 查询处理
- **描述**: 为每个跟踪单号顺序进行 API 调用
- **端点**: `http://sys-new-api.auodexpress.com/api/tms/userSys/client/getRouterList`
- **方法**: POST
- **负载**: `{ wayBillCode: string }`
- **处理**: 顺序处理（一次一个）
- **进度跟踪**: 计数器显示剩余查询数

#### 3. 结果显示
- **描述**: 显示跟踪状态和创建日期，带视觉状态分类
- **格式**: 结果列表，包含跟踪单号、状态、日期和快递代码（如可用）
- **更新**: 每次 API 调用完成时实时更新
- **组件**: `ResultList` 组件
- **状态分类**:
  - **已送达**: 红色边框和背景 (`border-destructive/50 bg-destructive/5`) - 状态包含"感谢使用"
  - **运输中**: 琥珀色/黄色边框和背景 (`border-amber-500/50 bg-amber-50/50`) - 状态包含"您的快件"或"正在派件"
  - **其他状态**: 默认边框样式
- **快递代码显示**: 为已送达和运输中的物品显示 `wbInfo.expressCode`

#### 4. 错误处理
- **描述**: 捕获并显示带详细消息的 API 错误
- **显示**: 
  - 错误消息以红色文本显示，带破坏性样式
  - 当 `result.result === false` 时显示 API 错误消息 (`result.msg`)
  - 网络错误以用户友好的消息显示
- **恢复**: 用户可以重试提交

#### 5. 加载状态
- **描述**: API 调用期间的视觉反馈
- **指示器**: 加载文本和进度计数器
- **状态管理**: React useState 钩子

#### 6. 智能缓存
- **描述**: 智能缓存机制，避免冗余的 API 调用
- **逻辑**: 
  - 在进行 API 调用之前，检查跟踪单号是否已有已送达状态
  - 已送达的物品（状态包含"感谢使用"）跳过 API 查询
  - 保留已送达物品的现有结果
- **优势**: 
  - 减少 API 调用并提高性能
  - 对于包含已送达物品的批次，响应时间更快
  - 通过即时显示缓存结果提供更好的用户体验

### 计划功能（Supabase 迁移）

#### 7. 云存储
- **描述**: 用 Supabase 数据库替换 localStorage
- **优势**: 跨设备同步，更好的数据持久化
- **实现**: 基于会话标识的匿名访问
- **存储**: 每个会话的跟踪单号数组

## 技术要求

### API 要求
- **外部 API**: auodexpress.com 跟踪 API
- **CORS 处理**: 需要 CORS 代理 (cors-anywhere.herokuapp.com)
- **请求格式**: JSON POST 请求
- **响应格式**: JSON，包含状态信息的 `data.hisList[]` 和快递代码的 `data.wbInfo.expressCode`
- **错误处理**: 必须优雅地处理网络错误和 API 错误
- **响应结构**: 
  ```typescript
  {
    data: {
      hisList: Array<{ toStatus: string; createDate: string }>,
      wbInfo: { expressCode: string }
    },
    msg: string,
    result: boolean
  }
  ```

### 数据模型

#### 当前（localStorage）
```typescript
{
  previousInputs: string[] // 跟踪单号数组
}
```

#### 计划（Supabase）
```sql
tracking_inputs {
  id: uuid (主键)
  session_id: text (浏览器会话标识符)
  inputs: text[] (跟踪单号数组)
  created_at: timestamp
  updated_at: timestamp
}
```

### 性能要求
- **初始加载**: < 2 秒
- **API 响应**: 通过进度指示器优雅地处理延迟
- **输入响应**: 文本更改时立即反馈
- **批量处理**: 顺序处理在当前规模下可接受

### 浏览器兼容性
- **最低要求**: 支持 ES2017+ 的现代浏览器
- **必需功能**: localStorage, fetch/axios, React 19
- **已测试**: Chrome, Firefox, Safari, Edge（最新版本）

## 非功能性要求

### 安全性
- **当前**: 不需要身份验证
- **数据隐私**: 跟踪单号存储在本地（浏览器）
- **未来**: 基于会话隔离的匿名 Supabase 访问
- **CORS**: 需要代理来访问外部 API

### 可扩展性
- **当前**: 适合个人/小团队使用
- **限制**: 顺序 API 处理对于大批量可能较慢
- **未来**: 考虑并行处理以提高性能

### 可用性
- **界面**: 使用 Tailwind CSS 的简洁、最小化设计
- **响应式**: 在桌面和平板上工作（移动优化待定）
- **可访问性**: 基本 HTML 语义，可以改进

### 可靠性
- **错误恢复**: 用户可以重试失败的操作
- **数据丢失预防**: 输入更改时自动保存
- **API 弹性**: 向用户显示错误消息

## 成功指标

### 用户参与度
- **主要**: 每个会话的跟踪查询数量
- **次要**: 回访用户率
- **目标**: 用户每个会话跟踪 5+ 个单号

### 性能
- **主要**: 完成批量查询的平均时间
- **次要**: 错误率
- **目标**: 10 个跟踪单号 < 30 秒

### 数据持久化
- **主要**: 返回使用已保存输入的用户百分比
- **次要**: 跨设备使用（Supabase 迁移后）
- **目标**: 50%+ 用户使用已保存的输入

## 未来增强

### 短期（下一个冲刺）
1. **Supabase 迁移**: 用云存储替换 localStorage
2. **输入验证**: 验证跟踪单号格式
3. **移动优化**: 改进移动 UI/UX

### 中期（下一季度）
1. **并行处理**: 并发处理多个 API 调用
2. **缓存**: 缓存 API 响应以减少冗余调用
3. **导出功能**: 将结果导出为 CSV/Excel
4. **历史记录**: 使用时间戳跟踪查询历史

### 长期（未来）
1. **用户身份验证**: 个人数据的可选用户账户
2. **多承运商支持**: 支持多个物流承运商
3. **通知**: 状态变更的电子邮件/推送通知
4. **仪表板**: 分析和报告功能
5. **API 速率限制**: 优雅地处理 API 速率限制

## 技术约束

### 当前约束
1. **CORS 代理依赖**: 依赖外部 CORS 代理服务
2. **顺序处理**: API 调用一次处理一个
3. **仅本地存储**: 数据仅限于单个浏览器/设备
4. **单一 API 源**: 仅支持 auodexpress.com API

### 未来考虑
1. **代理可靠性**: 考虑自托管 CORS 代理
2. **API 速率限制**: 可能需要实现速率限制
3. **数据库成本**: 监控 Supabase 使用和成本
4. **可扩展性**: 为增加的并发用户制定计划

## 依赖项

### 外部服务
- **CORS 代理**: cors-anywhere.herokuapp.com（当前）
- **跟踪 API**: sys-new-api.auodexpress.com
- **未来**: Supabase（数据库服务）

### 技术栈
- Next.js 15.1.2
- React 19.0.0
- TypeScript 5
- Tailwind CSS 3.4.1
- Axios 1.7.9
- Material-UI 6.3.0

## 审批

**产品负责人**: [待分配]  
**技术负责人**: [待分配]  
**日期**: [待填写]

---

*本文档是活文档，将随着产品的发展而更新。*
